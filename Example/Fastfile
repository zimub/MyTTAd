# Fastfile
default_platform(:ios)

platform :ios do
  desc "Package MyTTAd framework"
  lane :package do
    # 检查可用的 scheme
    schemes = sh("xcodebuild -workspace MyTTAd.xcworkspace -list | grep -i Scheme", log: false)
    puts "可用的 Scheme: #{schemes}"
    
    gym(
      scheme: "MyTTAd",  # 根据实际 scheme 名称调整
      workspace: "MyTTAd.xcworkspace",
      configuration: "Release",
      export_method: "development",
      output_directory: "build",
      output_name: "MyTTAd.framework",
      skip_package_ipa: true,
      skip_archive: false,
      build_path: "build",
      xcargs: {
        :ARCHS => "arm64 x86_64",
        :VALID_ARCHS => "arm64 x86_64",
        :ONLY_ACTIVE_ARCH => "NO",
        :BUILD_LIBRARY_FOR_DISTRIBUTION => "YES"
      }
    )
    
    # 检查生成的文件
    sh "ls -la build/"
  end
end